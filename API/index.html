<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Farmingo API â€“ Smart Crop Recommendation</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-green-50 to-emerald-100 text-gray-900 min-h-screen">
  <!-- Header -->
  <header class="w-full shadow-md bg-white/80 backdrop-blur border-b border-green-200">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-green-700">ğŸŒ¾ Farmingo API</h1>
      <nav class="space-x-6 text-gray-700 font-medium">
        <a href="#features" class="hover:text-green-600">Features</a>
        <a href="#docs" class="hover:text-green-600">API Docs</a>
        <a href="#try" class="hover:text-green-600">Try Now</a>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="max-w-6xl mx-auto px-6 mt-10 text-center">
    <h2 class="text-4xl font-extrabold text-green-800 mb-4">
      Intelligent Crop Recommendation System
    </h2>
    <p class="text-lg text-gray-700 max-w-2xl mx-auto">
      Powered by machine learning, real-time location intelligence, and agricultural insights.
      Get personalized crop recommendations based on soil, climate & region.
    </p>
  </section>

  <!-- Try Now Section -->
  <section id="try" class="max-w-md mx-auto mt-10">
    <div class="bg-white shadow-lg rounded-2xl p-6 border border-green-100">
      <h3 class="text-xl font-semibold text-center text-green-700 mb-4">
        ğŸŒ± Try Crop Recommendation
      </h3>

      <p id="status" class="text-gray-500 text-center mb-4">
        Detecting your location...
      </p>

      <!-- Result Box -->
      <div id="result" class="hidden bg-green-50 rounded-xl p-4 border border-green-200 my-3">
        <p><strong>ğŸ“ Location:</strong> <span id="coords"></span></p>
        <p><strong>ğŸï¸ State:</strong> <span id="state"></span></p>
        <p><strong>ğŸŒ¾ Recommended Crop:</strong> <span id="crop" class="font-bold text-green-700"></span></p>
        <p><strong>ğŸŒ± Alternatives:</strong> <span id="alternatives"></span></p>
      </div>

      <div id="error" class="hidden text-red-500 mt-4 text-center font-medium"></div>

      <!-- Loader animation -->
      <div id="loader" class="flex justify-center mt-4">
        <div class="w-6 h-6 border-4 border-green-400 border-t-transparent rounded-full animate-spin"></div>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section id="features" class="max-w-6xl mx-auto px-6 mt-20">
    <h3 class="text-3xl font-bold text-green-800 text-center mb-8">ğŸ’¡ Features</h3>

    <div class="grid md:grid-cols-3 gap-6">
      <div class="bg-white p-6 rounded-xl shadow border border-green-100">
        <h4 class="text-lg font-bold text-green-700 mb-2">ğŸ“ Auto Geo-Location</h4>
        <p class="text-gray-600">Detects precise latitude/longitude and maps them to your Indian state.</p>
      </div>

      <div class="bg-white p-6 rounded-xl shadow border border-green-100">
        <h4 class="text-lg font-bold text-green-700 mb-2">ğŸ¤– ML-Based Crop Prediction</h4>
        <p class="text-gray-600">Predicts the most suitable crop using your regional environmental profile.</p>
      </div>

      <div class="bg-white p-6 rounded-xl shadow border border-green-100">
        <h4 class="text-lg font-bold text-green-700 mb-2">ğŸŒ± Alternative Crop Suggestions</h4>
        <p class="text-gray-600">Gives additional options that are partially suitable for your location.</p>
      </div>
    </div>
  </section>

  <!-- API Documentation -->
  <section id="docs" class="max-w-6xl mx-auto px-6 mt-20 pb-20">
    <h3 class="text-3xl font-bold text-green-800 text-center mb-8">ğŸ“˜ API Documentation</h3>

    <div class="space-y-6">
      <div class="bg-white p-6 rounded-xl shadow border border-green-100">
        <h4 class="text-lg font-bold text-green-700 mb-2">ğŸ”¹ POST /recommend</h4>
        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto">
{
  "auto_location": true,
  "latitude": 22.5726,
  "longitude": 88.3639
}
        </pre>
      </div>

      <div class="bg-white p-6 rounded-xl shadow border border-green-100">
        <h4 class="text-lg font-bold text-green-700 mb-2">ğŸ”¹ POST /crop_disease_prediction</h4>
        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto">
?crop_name=chilli
        </pre>
      </div>

      <div class="bg-white p-6 rounded-xl shadow border border-green-100">
        <h4 class="text-lg font-bold text-green-700 mb-2">ğŸ”¹ POST /crop_price</h4>
        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto">
{
  "crop": "wheat",
  "region": "Delhi",
  "date": "2025-02-01"
}
        </pre>
      </div>

      <p class="text-center text-gray-600 mt-6">
        More detailed API docs coming soonâ€¦
      </p>
    </div>
  </section>

  <!-- Script -->
<script>
async function sendLocation(latitude, longitude) {
  try {
    document.getElementById("loader").classList.remove("hidden");

    const response = await fetch("/recommend", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        auto_location: true,
        latitude,
        longitude
      })
    });

    if (!response.ok) throw new Error("API error");

    const data = await response.json();

    document.getElementById("status").classList.add("hidden");
    document.getElementById("loader").classList.add("hidden");
    document.getElementById("result").classList.remove("hidden");

    document.getElementById("coords").textContent =
      `${data.coords.latitude.toFixed(4)}, ${data.coords.longitude.toFixed(4)}`;
    document.getElementById("state").textContent = data.state;
    document.getElementById("crop").textContent = data.predicted_crop;
    document.getElementById("alternatives").textContent =
      data.partially_suitable.length ? data.partially_suitable.join(", ") : "None";

  } catch (err) {
    document.getElementById("loader").classList.add("hidden");
    document.getElementById("error").textContent =
      "âŒ Failed to fetch recommendation. See console for details.";
    document.getElementById("error").classList.remove("hidden");
  }
}

document.addEventListener("DOMContentLoaded", () => {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        document.getElementById("status").textContent = "Location found! Fetching recommendation...";
        sendLocation(pos.coords.latitude, pos.coords.longitude);
      },
      err => {
        document.getElementById("status").textContent = "Location access denied.";
        document.getElementById("error").textContent =
          "Please enable location permissions and refresh.";
        document.getElementById("error").classList.remove("hidden");
      }
    );
  } else {
    document.getElementById("status").textContent = "Geolocation not supported.";
  }
});
</script>

</body>
</html>
